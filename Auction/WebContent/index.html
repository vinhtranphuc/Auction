<!DOCTYPE html>
<html>
<head>
<title>Auction</title>

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="author" content="">

<!-- Latest compiled and minified CSS -->
<link rel="stylesheet"
	href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

<link
	href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap-glyphicons.css"
	rel="stylesheet">

<!-- jQuery library -->
<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>

<!-- Latest compiled JavaScript -->
<script
	src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

</head>
<body>
	<!-- starting container -->
	<div class="container" style="margin-top: 1%">

		<!-- staring panel -->
		<div class="panel panel-default">
			<!-- starting panel body -->
			<div class="panel-body">

				<!-- starting action bar -->
				<div class="row">

					<!-- staring avatar -->
					<div class="col-md-8">
						<div class="row">
							<div class="col-sm-2">
								<img src="img/hulk.jpg" class="img-thumbnail" alt="avatar"
									width="80" height="80">
							</div>
							<div class="col-sm-8">
								<h5 style="margin-left: -7%;">Hulk</h5>
							</div>
						</div>
					</div>
					<!-- ending avatar -->

					<!-- starting button group -->
					<div class="col-sm-4">
						<div class="pull-right" style="margin-top: 3%;">
							<button type="button" class="btn btn-default">Đăng nhập</button>
							<button type="button" class="btn btn-info">Đăng ký</button>
						</div>
					</div>
					<!-- endiung button group -->
				</div>
				<!-- ending action bar -->
				<hr>
				<!-- starting auction list -->
				<div class="row">
					<div class="col-sm-2">
						<h4>Phiếu đấu giá</h4>
					</div>
					<div class="col-sm-3">
						<form class="pull-right">
							<div class="input-group">
								<input type="text" class="form-control"
									placeholder="Tìm mặt hàng">
								<div class="input-group-btn">
									<button class="btn btn-default" type="submit">
										<i class="glyphicon glyphicon-search"></i>
									</button>
								</div>
							</div>
						</form>
					</div>
					<div class="col-sm-6"></div>
				</div>

				<table class="table table-striped" id="auction-coupon-list-table">
					<thead>
						<tr>
							<th style="width: 9%">Mặt hàng</th>
							<th style="width: 7%">Chi tiết</th>
							<th style="width: 7%">Giá bắt đầu</th>
							<th style="width: 7%">Giá HT</th>
							<th style="width: 12%">Người SC</th>
							<th style="width: 5%">Bước giá</th>
							<th style="width: 10%">TG bắt đầu</th>
							<th style="width: 10%">TG kết thúc</th>
							<th style="width: 10%">TG còn lại</th>
							<th style="width: 5%">Hủy</th>
						</tr>
					</thead>
					<tbody id="auction-coupon-list-body">
						<!-- 						<tr>
							<td>product</td>
							<td>
								<button type="button" class="btn btn-info btn-xs"
								data-toggle="modal" data-target="#modal-detail-product">XemMbid</button>
							</td>
							<td>startingPrice</td>
							<td>highestPrice" /></td>
							<td>name" /></td>
							<td>stepPrice</td>
							<td>startTime</td>
							<td>endTime</td>
							<td><span style="color: red">
								id="count-down-productID"> </span></td>
								<td>
									<button type="button" class="btn btn-danger btn-xs">Hủy
									mbid</button>
								</td>
							</tr> -->
					</tbody>
				</table>
				<!-- ending auction list -->
			</div>
			<!-- ending panel body -->

		</div>
		<!-- ending panel -->

	</div>
	<!-- ending container -->

	<!-- Modals -->
	<!-- Starting detail product & order modal -->
	<div class="modal fade" id="modal-detail-product" role="dialog">

		<div class="modal-dialog">

			<!-- Modal content-->
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal">&times;</button>
					<h6 class="modal-title">
						<b>Chi tiết phiếu đấu giá</b>
					</h6>
				</div>
				<div class="modal-body">
					<div class="row">
						<div class="col-sm-4">
							<img src="img/iphonex.jpg" class="img-thumbnail" alt="iphoneX"
								width="250" height="250">
						</div>
						<div class="col-sm-8">
							<p>Mua điện thoại Apple iPhone X - iPhone 10 chính hãng, bảo
								hành 1 đổi 1 trong 12 tháng tại Hệ thống CellphoneS.com.vn ✓Trả
								góp 0% ✓Giá rẻ hơn ✓Giao iPhone 10 chính hãng, bảo hành 1 đổi 1
								trong 12 tháng tại Hệ thống CellphoneS.com.vn ✓Trả góp iPhone 10
								chính hãng, bảo hành 1 đổi 1 trong 12 tháng tại Hệ thống
								CellphoneS.com.vn ✓Trả góp iPhone 10 chính hãng, bảo hành 1 đổi
								1 trong 12 tháng tại Hệ thống CellphoneS.com.vn ✓Trả góp</p>
						</div>
					</div>
				</div>
				<div class="modal-footer">
					<div class="row">
						<div class="col-md-3">
							<div class="form-inline">
								<div class="form-group">
									<b> <span style="color: red;"> 1 day 2h:30m 20s </span>
									</b>
								</div>
							</div>
						</div>
						<div class="col-md-9">
							<div class="form-inline pull-right">
								<div class="form-group">
									<input type="text" class="form-control" id="pwd"
										placeholder="Nhập giá">
								</div>
								<button class="btn btn-primary">Đặt giá</button>
							</div>
						</div>
					</div>
				</div>
			</div>

		</div>
	</div>
	<!-- Ending detail product & order modal  -->
	<!-- End modals -->

	<script type="text/javascript">
		var websocket = new WebSocket(
				"ws://localhost:8089/Auction/ServerEndPoint");

		websocket.onopen = function(message) {
			processOpen(message);

		};
		websocket.onmessage = function(message) {
			processMessage(message);
		};

		websocket.onclose = function(message) {
			processClose(message);
		};
		websocket.onerror = function(message) {
			processError(message);
		};

		function processOpen(message) {

		}
		function processMessage(message) {

			console.log(message);

			var arr = message.data;

			loadAuctionCouponList(arr);
			
			handleDisplayCountdown();
		}
		function processClose(message) {

		}
		function processError(message) {

		}

		function sendMessage() {
			if (typeof websocket != 'undefined'
					&& websocket.readyState == WebSocket.OPEN) {
				websocket.send("data");
			}
		}
	</script>

	<script type="text/javascript">
		//Load danh sách phiếu đấu giá
		function loadAuctionCouponList(auctionListString) {

			var arrObject = eval('(' + auctionListString + ')');

			var result = "";

			for ( var i in arrObject) {
				result += "<tr>" + "<td>"
						+ arrObject[i]["product"]
						+ "</td>"
						+ "<td>"
						+ "<button type=\"button\" class=\"btn btn-info btn-xs\" id = \""+arrObject[i]["productID"]+"\""
					+"data-toggle=\"modal\" data-target=\"#modal-detail-product\"> Chi tiết </button>"
						+ "</td>"
						+ "<td> "
						+ arrObject[i]["startingPrice"]
						+ "</td>"
						+ "<td> "
						+ arrObject[i]["highestPrice"]
						+ "</td>"
						+ "<td> "
						+ arrObject[i]["name"]
						+ "</td>"
						+ "<td> "
						+ arrObject[i]["stepPrice"]
						+ "</td>"
						+ "<td> "
						+ arrObject[i]["startTime"]
						+ "</td>"
						+ "<td> "
						+ arrObject[i]["endTime"]
						+ "</td>"
						+ "<td>"
						+ "<span style=\"color: red\" id=\"count-down-"+arrObject[i]["productID"]+"\">"
						+ "</span>"
						+ "</td>"
						+ "<td>"
						+ "<button type=\"button\" id=\"cancle-"+arrObject[i]["productID"]+"\" class=\"btn btn-danger btn-xs\">Hủy</button>"
						+ "</td>" + "</tr>";
			}
			
			// write html to body table
			$('#auction-coupon-list-body').html(result);
		}
	</script>

	<script type="text/javascript">
		window.addEventListener('load', function() {

			}
		}, false);
	</script>
	
	<script type="text/javascript">
		function handleDisplayCountdown() {

			// get auction list
			var table = document.getElementById("auction-coupon-list-body");

			// loop each row in table
			for (var i = 0, row; row = table.rows[i]; i++) {

				// get end time for each row
				var end_time = row.cells[7].innerHTML;

				// get id name of span
				var span_id = row.cells[8].getElementsByTagName("span")[0]
						.getAttribute("id");

				// process display countdown time
				countDownTimer(span_id, end_time);
			}
		}
		
		// function process display countdown time to span
		function countDownTimer(element_id, end_time) {
	
			// Set the date we're counting down to
			var countDownDate = new Date(end_time).getTime();

			// Update the count down every 1 second
			var x = setInterval(function() {

				// Get todays date and time
				var now = new Date().getTime();

				// Find the distance between now an the count down date
				var distance = countDownDate - now;

				// Time calculations for days, hours, minutes and seconds
				var days = Math.floor(distance / (1000 * 60 * 60 * 24));
				var hours = Math.floor((distance % (1000 * 60 * 60 * 24))
						/ (1000 * 60 * 60));
				var minutes = Math.floor((distance % (1000 * 60 * 60))
						/ (1000 * 60));
				var seconds = Math.floor((distance % (1000 * 60)) / 1000);

				// Output the result in an element with id="demo"
				document.getElementById(element_id).innerHTML = days + "d "
						+ hours + "h " + minutes + "m " + seconds + "s ";

				// If the count down is over, write some text 
				if (distance < 0) {
					clearInterval(x);					
					document.getElementById(element_id).innerHTML = "Hết giờ";
				}
			}, 1000);
		}
	</script>
</body>
</html>