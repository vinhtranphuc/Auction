 WHEN (EXISTS( SELECT PRODUCTS.PRODUCT_ID FROM PRODUCTS JOIN AUCTION ON PRODUCTS.PRODUCT_ID = AUCTION.PRODUCT_ID WHERE AUCTION.STOP_AUCTION_FLAG = 1 AND AUCTION.PRODUCT_ID = PRODUCTS.PRODUCT_ID )) THEN 'Đã dừng đăng tải'
 
 SELECT PRODUCTS.PRODUCT_ID, PRODUCT, PRODUCTS.CATEGORY_ID, CATEGORY, IMAGE_PATH, PRODUCTS.DESCRIBE, START_TIME, END_TIME, STARTING_PRICE, STEP_PRICE, MARKET_PRICE, ( CASE WHEN EXISTS( SELECT MEMBER_ID FROM ORDERER WHERE PRODUCT_ID = PRODUCTS.PRODUCT_ID ) THEN( SELECT MEMBER_NAME FROM AUCTIONEER JOIN ORDERER ON AUCTIONEER.MEMBER_ID = ORDERER.MEMBER_ID WHERE ORDERER.ORDER_PRICE =( SELECT MAX(ORDERER.ORDER_PRICE) FROM ORDERER JOIN AUCTION ON ORDERER.PRODUCT_ID = AUCTION.PRODUCT_ID JOIN PRODUCTS ON PRODUCTS.PRODUCT_ID = ORDERER.PRODUCT_ID WHERE PRODUCTS.PRODUCT_ID = PRODUCTS.PRODUCT_ID ) ) ELSE '' END ) AS WINNER_AUCTION, ( CASE WHEN( SELECT MAX(ORDERER.ORDER_PRICE) FROM ORDERER
 
 SELECT PRODUCTS.PRODUCT_ID, PRODUCT, PRODUCTS.CATEGORY_ID, CATEGORY, IMAGE_PATH, PRODUCTS.DESCRIBE, START_TIME, END_TIME, STARTING_PRICE, STEP_PRICE, MARKET_PRICE,(CASE WHEN EXISTS (SELECT MEMBER_ID FROM ORDERER WHERE PRODUCT_ID = PRODUCTS.PRODUCT_ID) THEN( SELECT MEMBER_NAME FROM AUCTIONEER JOIN ORDERER ON AUCTIONEER.MEMBER_ID = ORDERER.MEMBER_ID WHERE ORDERER.ORDER_PRICE = (SELECT MAX(ORDERER.ORDER_PRICE) FROM ORDERER JOIN AUCTION ON ORDERER.PRODUCT_ID = AUCTION.PRODUCT_ID JOIN PRODUCTS ON PRODUCTS.PRODUCT_ID = ORDERER.PRODUCT_ID WHERE PRODUCTS.PRODUCT_ID = PRODUCTS.PRODUCT_ID )) ELSE '' END) AS WINNER_AUCTION, ( CASE WHEN( SELECT MAX(ORDERER.ORDER_PRICE) FROM ORDERER WHERE PRODUCT_ID = PRODUCTS.PRODUCT_ID ) IS NULL THEN 0 ELSE( SELECT MAX(ORDERER.ORDER_PRICE) FROM ORDERER WHERE PRODUCT_ID = PRODUCTS.PRODUCT_ID ) END ) AS HIGHEST_PRICE, ( CASE WHEN EXISTS( SELECT MEMBER_ID FROM ORDERER WHERE PRODUCT_ID = PRODUCTS.PRODUCT_ID ) THEN ( SELECT ORDERER.MEMBER_ID FROM AUCTIONEER JOIN ORDERER ON AUCTIONEER.MEMBER_ID = ORDERER.MEMBER_ID WHERE ORDERER.ORDER_PRICE = (SELECT MAX(ORDERER.ORDER_PRICE) FROM ORDERER JOIN AUCTION ON ORDERER.PRODUCT_ID = AUCTION.PRODUCT_ID JOIN PRODUCTS ON PRODUCTS.PRODUCT_ID = ORDERER.PRODUCT_ID WHERE PRODUCTS.PRODUCT_ID = PRODUCTS.PRODUCT_ID)) ELSE '' END ) AS MEMBERID_WINNER, ( CASE WHEN NOW() < START_TIME THEN 'Chưa bắt đầu' WHEN (START_TIME <= NOW() AND NOW() < END_TIME) THEN 'Đang đấu giá' WHEN NOW() >= END_TIME AND EXISTS(SELECT PRODUCT_ID FROM ORDERER WHERE ORDERER.PRODUCT_ID = PRODUCTS.PRODUCT_ID ) THEN 'Hết thời gian - đã được order' WHEN NOW() >= END_TIME AND EXISTS(SELECT PRODUCT_ID FROM ORDERER WHERE ORDERER.PRODUCT_ID = PRODUCTS.PRODUCT_ID ) THEN 'Hết thời gian - không được order' WHEN (EXISTS( SELECT PRODUCTS.PRODUCT_ID FROM PRODUCTS JOIN AUCTION ON PRODUCTS.PRODUCT_ID = AUCTION.PRODUCT_ID WHERE AUCTION.STOP_AUCTION_FLAG = 1 AND AUCTION.PRODUCT_ID = PRODUCTS.PRODUCT_ID )) THEN 'Đã dừng đăng tải' ELSE 'FAIL' END) AS STATUS FROM CATEGOTIES, PRODUCTS, AUCTION, AUCTIONEER WHERE CATEGOTIES.CATEGORY_ID = PRODUCTS.CATEGORY_ID AND PRODUCTS.PRODUCT_ID = AUCTION.PRODUCT_ID AND AUCTION.MEMBER_ID = AUCTIONEER.MEMBER_ID AND PRODUCTS.PRODUCT_ID = ? AND AUCTION.MEMBER_ID = ?